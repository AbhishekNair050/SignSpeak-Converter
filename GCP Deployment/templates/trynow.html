<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Speak</title>
    <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
    <style>
        /* Custom styling */
        .Rectangle2 {
            width: 100%;
            height: 12%;
            left: 0;
            top: 0;
            position: absolute;
            background: #1995EF;
        }
        
        .GlobalImpact{
            width: 13%;
            height: 6.2963%;
            left: 2.5%;
            top: 3.25%;
            position: absolute;
            color: black;
            font-size: 120%; /* Increase the font size */
            font-weight: 600;
            word-wrap: break-word;
        }
        .OurVision{
            width: 10.9375%;
            height: 6.2963%;
            left: 15%;
            top: 3.25%;
            position: absolute;
            color: black;
            font-size: 120.5%; /* Increase the font size */
            font-weight: 600;
            word-wrap: break-word;
        }
        .TryNow{
            width: 10.9375%;
            height: 6.2963%;
            left: 25%;
            top: 3.25%;
            position: absolute;
            color: black;
            font-size: 120.5%; /* Increase the font size */
            font-weight: 600;
            word-wrap: break-word;
        }
        .Use{
            width: 10.9375%;
            height: 6.2963%;
            left: 33.5%;
            top: 3.25%;
            position: absolute;
            color: black;
            font-size: 120.5%; /* Increase the font size */
            font-weight: 600;
            word-wrap: break-word;
        }
        .ContactUs{
            width: 10.9375%;
            height: 6.2963%;
            left: 44%;
            top: 3.25%;
            position: absolute;
            color: black;
            font-size: 120.5%; /* Increase the font size */
            font-weight: 600;
            word-wrap: break-word;
        }
        .Button {
            display: inline-block;
            padding: 8px 20px;
            background-color: #1995EF; /* Green color, you can change this */
            color: black;
            text-decoration: none;
            font-size: 16px;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        
        .Button:hover {
            background-color: white;
        }

        /* Styling for sections and input options */
        body {
            font-family: Poppins;
            margin: 0;
            padding: 0;
            scroll-behavior: smooth;
        }
        .container {
            text-align: center;
            margin-top: 60px;
        }
        .section-container {
            display: none; /* Hide sections by default */
        }
        section {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
        }
        #section1 {
            background-color: #f8f9fa;
        }
        #section2 {
            background-color: #e9ecef;
            padding: 20px;
            text-align: center;
        }
        #inputOptions {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }
        input[type="text"] {
            padding: 10px;
            font-size: 1.5rem;
            margin-right: 10px;
            width: 300px;
            border-radius: 5px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            background-color: #1995EF;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #007acc;
        }
        select {
            font-size: 1.5rem;
            padding: 10px;
            cursor: pointer;
            margin-top: 20px;
        }
        #video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
    </style>
</head>
<body>
    <!-- Initial div and links -->
    <div class="Rectangle2"></div>
    <div class="GlobalImpact">
        <a href="impact.html" class="Button">Global Impact</a>
    </div>
    <div class="OurVision">
        <a href="vision.html" class="Button">Our Vision</a>
    </div>
    <div class="TryNow">
        <a href="trynow.html" class="Button">Try Now</a>
    </div>
    <div class="Use">
        <a href="use.html" class="Button">Use Cases</a>
    </div>
    <div class="ContactUs">
        <a href="contact.html" class="Button">Contact Us</a>
    </div>

    <!-- Container for dropdown and sections -->
    <div class="container">
        <select id="sectionDropdown" onchange="toggleSection(this.value)">
            <option value="" selected disabled>Select a Section</option>
            <option value="section1">Sign Language to Text</option>
            <option value="section2">Text and Audio Input</option>
        </select>
    </div>

    <!-- Sections -->
    <div class="section-container" id="section1Container">
        <section id="section1">
            <div class="box" style="width: 45%; height: 70%; left: 8%; top: 37%; position: absolute; background: #F9FEFF; border-radius: 16px; border: 5px #ff8c00 solid; backdrop-filter: blur(4px);">
                <video id="video" autoplay playsinline muted></video>
            </div>
            <div class="box" style="width: 35%; height: 10%; left: 60%; top: 37%; position: absolute; background: #F9FEFF; border: 5px #ff8c00 solid; backdrop-filter: blur(4px); font-size: 60%;padding: 15px;">
                <h4 id="label">Label: </h4>
                <h4 id="certainty">Certainty: %</h4>
            </div>
            <div class="box" style="width: 35%; height: 45%; left: 60%; top: 57%; position: absolute; background: #F9FEFF; border: 1px #ff8c00 solid; backdrop-filter: blur(4px); font-size: 60%;padding: 15px;">
                Disclaimer: This is a prototype and may not be accurate, we are using an optimized version of the model for real-time inference as it becomes too much for the web server to handle the original model, the results may vary from the original model and may not be completely accurate. We only display the label when the certainty is above 70% to improve the accuracy of the results.
            </div> 
        </section>
    </div>
    <div class="section-container" id="section2Container">
        <section id="section2">
            <div class="box" style="width: 45%; height: 70%; left: 8%; top: 37%; position: absolute; background: #F9FEFF; border-radius: 16px; border: 5px #ff8c00 solid; backdrop-filter: blur(4px);">
                <video id="outputVideo" playsinline muted></video>
            </div>
            <div id="inputOptions">
                <input type="text" id="textInput" placeholder="Type your text">
                <button onclick="submitText()">Submit Text</button>
                <button onclick="startListening()">Start Listening</button>
                <button onclick="stopListening()">Stop Listening</button>
            </div>
            <div id="transcription"></div>
        </section>
    </div>
    <script>
        let recognition;

        function toggleSection(sectionId) {
            const section1Container = document.getElementById("section1Container");
            const section2Container = document.getElementById("section2Container");
        
            if (sectionId === "section1") {
                section1Container.style.display = "block";
                section2Container.style.display = "none";
                scrollToSection(sectionId);
            } else if (sectionId === "section2") {
                section1Container.style.display = "none";
                section2Container.style.display = "block";
                scrollToSection(sectionId);
            }
        }
        
        function scrollToSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.scrollIntoView({ behavior: "smooth" });
            }
        }

        function submitText() {
            const textInput = document.getElementById("textInput").value;
        }

        function startListening() {
            if (!('webkitSpeechRecognition' in window)) {
                alert("Speech recognition is not supported by this browser.");
                return;
            }

            recognition = new webkitSpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'en-US';

            recognition.onresult = function(event) {
                let interimTranscript = '';
                let finalTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; i++) {
                    let transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript;
                    } else {
                        interimTranscript += transcript;
                    }
                }

                document.getElementById('transcription').textContent = finalTranscript;
            };

            recognition.start();
        }

        function stopListening() {
            if (recognition) {
                recognition.stop();
            }
        }
        const labelElement = document.getElementById('label');
            const certaintyElement = document.getElementById('certainty');
            const videoElement = document.getElementById('video');

            let streaming = false;
            let videoStream;

            async function startCamera() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                    videoElement.srcObject = stream;
                    videoStream = stream;
                    videoElement.addEventListener('canplay', () => {
                        if (!streaming) {
                            streaming = true;
                            setInterval(sendFrame, 1000); // Set the interval based on your needs
                        }
                    });
                } catch (error) {
                    console.error('Error accessing camera:', error);
                    labelElement.innerText = 'Error accessing camera';
                    certaintyElement.innerText = '';
                }
            }

            startCamera();

            function sendFrame() {
                const canvas = document.createElement('canvas');
                canvas.width = videoElement.videoWidth;
                canvas.height = videoElement.videoHeight;
                const context = canvas.getContext('2d');
                context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);

                canvas.toBlob(blob => {
                    const formData = new FormData();
                    formData.append('frame', blob, 'frame.jpg');

                    fetch('/process_frame', {
                        method: 'POST',
                        body: formData,
                    })
                    .then(response => response.json())
                    .then(data => {
                        labelElement.innerText = `Label: ${data.label}`;
                        certaintyElement.innerText = `Certainty: ${data.certainty}%`;
                    })
                    .catch(error => console.error('Error processing frame:', error));
                }, 'image/jpeg');
            }
            function submitText() {
                const textInput = document.getElementById("textInput").value;

                // Make an AJAX request to combine the videos
                fetch('/texttosign', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ sentence: textInput }),
                })
                .then(response => response.json())
                .then(data => {
                    // Update the video source with the combined video
                    const videoElement = document.getElementById('outputVideo');
                    videoElement.src = data.video_path;
                    videoElement.play();
                })
                .catch(error => console.error('Error combining videos:', error));
            }
    </script>
</body>
</html>
